# 好友列表

## 概述
此页面为用户提供了一个功能齐全的好友列表界面，包括搜索好友、显示好友信息、分页加载更多好友、实时更新未读消息数量等功能。用户可以通过搜索框输入关键词快速找到特定的好友。

## 功能详情

### 数据模型
- `friends`: 存储用户的好友列表。
- `searchKeyword`: 用户输入的搜索关键词。
- `searchResults`: 根据搜索关键词查询到的用户列表。
- `isSearching`: 标记是否处于搜索状态。
- `isLoading`: 标记当前是否在加载数据。
- `debounceTimer`: 用于搜索输入的防抖定时器。
- `pageSize`: 分页加载时每页显示的好友数量。
- `currentPage`: 当前加载的页码。
- `currentUserOpenId`: 当前用户的OpenID。
- `totalCount`: 好友总数，用于分页计算。
- `watcher`: 用于实时监听数据库中的数据变化。

### 主要方法
- `loadUserOpenId()`: 从全局数据或本地存储中获取当前用户的OpenID。
- `fetchFriendsWithUnreadCount()`: 获取全部好友信息，并附带未读消息数量。
- `getUnreadCount(friendOpenid)`: 获取与指定好友的未读消息数量。
- `onSearchInput(e)`: 处理搜索输入，添加防抖功能。
- `performSearch()`: 执行实际的搜索操作。
- `onImageError(e)`: 当好友头像加载失败时，设置默认头像。
- `onSelectFriend(e)`: 选择特定好友，进入聊天界面。
- `onScrollToLower()`: 滚动到页面底部时触发，加载更多好友。
- `initWatcher()`: 初始化实时数据监听器。

### 实时监听
此页面通过 `watcher` 监听 `messages` 集合的变化，以实时更新好友的未读消息数量。当收到新消息或消息状态更新时，相关好友列表中的未读消息红点会即时反映变化。

### 分页加载
通过滚动到页面底部触发加载更多好友的逻辑，实现分页效果。页面初始化和每次滚动到底部时，都会加载下一页的好友数据。

### 搜索功能
用户在搜索框中输入关键词后，页面会根据输入的内容实时过滤好友列表或查询数据库。搜索结果会高亮显示匹配的关键词，并且支持正则表达式匹配。

### 页面结构
- 搜索框：允许用户输入搜索关键词。
- 好友列表：展示当前用户的所有好友及其基本信息。
- 搜索结果：展示搜索匹配的用户列表。
- 加载指示器：在数据加载过程中显示。